package org.mkalina.bankid

import com.github.tomakehurst.wiremock.client.WireMock
import com.github.tomakehurst.wiremock.client.WireMock.aResponse
import com.github.tomakehurst.wiremock.client.WireMock.get
import kotlinx.coroutines.runBlocking
import org.assertj.core.api.Assertions.assertThat
import org.intellij.lang.annotations.Language
import org.junit.jupiter.api.Test
import org.springframework.beans.factory.annotation.Autowired
import org.springframework.boot.test.context.SpringBootTest
import org.springframework.test.context.TestPropertySource
import org.wiremock.spring.ConfigureWireMock
import org.wiremock.spring.EnableWireMock

@SpringBootTest
@EnableWireMock(ConfigureWireMock(port = 9998))
@TestPropertySource(properties = ["currency-list.url=http://localhost:9998"])
class CurrencyListClientTest(
    @Autowired val currencyListClient: CurrencyListClient
) {
    @Test
    fun `load rates`() = runBlocking {
        mockResponse()
        assertThat(currencyListClient.load()["AUD"]).isEqualTo("1.62802767".toBigDecimal())
        Unit
    }

    private fun mockResponse() {
        WireMock.stubFor(
            get("/").willReturn(
                aResponse()
                    .withHeader("Content-Type", "Application/JSON")
                    .withStatus(200)
                    .withBody(
                    body.trimIndent()
                )
            )
        )
    }

    @Language("JSON")
    val body = """
            {
                "date": "2024-10-10",
                "eur": {
                        "1000sats": 4134.73406137,
                        "1inch": 4.38825954,
                        "aave": 0.00775063,
                        "ada": 3.22491465,
                        "aed": 4.01919436,
                        "afn": 73.82514818,
                        "agix": 1.8752833,
                        "akt": 0.46462474,
                        "algo": 9.21433813,
                        "all": 98.51547037,
                        "amd": 421.92075176,
                        "amp": 296.66626714,
                        "ang": 1.96748033,
                        "aoa": 1009.26195786,
                        "ape": 1.54064601,
                        "apt": 0.12898643,
                        "ar": 0.06017171,
                        "arb": 2.09092692,
                        "ars": 1066.74945329,
                        "atom": 0.25751842,
                        "ats": 13.7603,
                        "aud": 1.62802767,
                        "avax": 0.042228294,
                        "awg": 1.95898105,
                        "axs": 0.24568269,
                        "azm": 9310.45212966,
                        "azn": 1.86209043,
                        "bake": 4.58482353,
                        "bam": 1.95583,
                        "bat": 6.5107808,
                        "bbd": 2.18880564,
                        "bch": 0.0033980999,
                        "bdt": 131.01435708,
                        "bef": 40.3399,
                        "bgn": 1.95583,
                        "bhd": 0.41149546,
                        "bif": 3174.4321694,
                        "bmd": 1.09440282,
                        "bnb": 0.0019155351,
                        "bnd": 1.43009053,
                        "bob": 7.57782391,
                        "brl": 6.12567501,
                        "bsd": 1.09440282,
                        "bsv": 0.024816516,
                        "bsw": 18.96394132,
                        "btc": 0.00001802372,
                        "btcb": 6.09293653,
                        "btg": 0.051106531,
                        "btn": 91.88384726,
                        "btt": 1213723.57901271,
                        "busd": 1.09347177,
                        "bwp": 14.56877995,
                        "byn": 3.57936928,
                        "byr": 35793.69278404,
                        "bzd": 2.21203741,
                        "cad": 1.50047047,
                        "cake": 0.59585304,
                        "cdf": 3132.29322868,
                        "celo": 1.5020427,
                        "cfx": 6.26600925,
                        "chf": 0.94163222,
                        "chz": 16.29236402,
                        "clp": 1021.45215515,
                        "cnh": 7.75017667,
                        "cny": 7.7436421,
                        "comp": 0.025368306,
                        "cop": 4635.7981871,
                        "crc": 567.24477235,
                        "cro": 14.53987214,
                        "crv": 4.23422614,
                        "cspr": 91.398011,
                        "cuc": 1.09440282,
                        "cup": 26.31235118,
                        "cve": 110.27,
                        "cvx": 0.59672172,
                        "cyp": 0.585274,
                        "czk": 25.34426788,
                        "dai": 1.09473773,
                        "dash": 0.047942902,
                        "dcr": 0.091188213,
                        "dem": 1.95583,
                        "dfi": 70.35395456,
                        "djf": 195.28052617,
                        "dkk": 7.45829635,
                        "doge": 10.0433264,
                        "dop": 65.96836004,
                        "dot": 0.27050883,
                        "dydx": 1.21332012,
                        "dzd": 145.75277387,
                        "eek": 15.64664,
                        "egld": 0.044259205,
                        "egp": 53.08107214,
                        "enj": 7.65243427,
                        "eos": 2.38666546,
                        "ern": 16.41604233,
                        "esp": 166.38600001,
                        "etb": 132.42349625,
                        "etc": 0.060067481,
                        "eth": 0.00045742032,
                        "eur": 1,
                        "fei": 1.12918003,
                        "fil": 0.31118639,
                        "fim": 5.94573,
                        "fjd": 2.43608697,
                        "fkp": 0.83710232,
                        "flow": 2.07668276,
                        "flr": 76.24399657,
                        "frax": 1.09801212,
                        "frf": 6.55957,
                        "ftm": 1.64799899,
                        "ftt": 0.51425845,
                        "fxs": 0.55495599,
                        "gala": 54.66268648,
                        "gbp": 0.83710232,
                        "gel": 2.9807916,
                        "ggp": 0.83710232,
                        "ghc": 174538.27047863,
                        "ghs": 17.45382705,
                        "gip": 0.83710232,
                        "gmd": 75.22496064,
                        "gmx": 0.052446244,
                        "gnf": 9444.23837755,
                        "gno": 0.0066678866,
                        "grd": 340.75000001,
                        "grt": 7.01103008,
                        "gt": 0.12270394,
                        "gtq": 8.47513393,
                        "gusd": 1.09360911,
                        "gyd": 228.89862124,
                        "hbar": 21.72324716,
                        "hkd": 8.50556822,
                        "hnl": 27.30615108,
                        "hnt": 0.16341291,
                        "hot": 724.35447145,
                        "hrk": 7.5345,
                        "ht": 2.11119755,
                        "htg": 144.73563284,
                        "huf": 399.05720749,
                        "icp": 0.13852652,
                        "idr": 17130.76500877,
                        "iep": 0.787564,
                        "ils": 4.12274783,
                        "imp": 0.83710232,
                        "imx": 0.79356266,
                        "inj": 0.056716636,
                        "inr": 91.88384726,
                        "iqd": 1434.31238076,
                        "irr": 46110.333846,
                        "isk": 148.50638355,
                        "itl": 1936.27000006,
                        "jep": 0.83710232,
                        "jmd": 173.14892469,
                        "jod": 0.7759316,
                        "jpy": 163.25939911,
                        "kas": 8.13428555,
                        "kava": 3.3178253,
                        "kcs": 0.13971948,
                        "kda": 2.15354199,
                        "kes": 141.30934833,
                        "kgs": 93.23287949,
                        "khr": 4453.82983803,
                        "klay": 8.55250536,
                        "kmf": 491.96775002,
                        "knc": 2.50794326,
                        "kpw": 984.94693384,
                        "krw": 1476.19980652,
                        "ksm": 0.061904269,
                        "kwd": 0.33563081,
                        "kyd": 0.89887644,
                        "kzt": 534.06304412,
                        "lak": 24160.91771782,
                        "lbp": 98355.60249252,
                        "ldo": 1.05275388,
                        "leo": 0.180587,
                        "link": 0.10328152,
                        "lkr": 321.48706453,
                        "lrc": 9.19659281,
                        "lrd": 211.48294908,
                        "lsl": 19.31241731,
                        "ltc": 0.016875697,
                        "ltl": 3.4528,
                        "luf": 40.3399,
                        "luna": 3.07894145,
                        "lunc": 13144.62061543,
                        "lvl": 0.7028,
                        "lyd": 5.23926391,
                        "mad": 10.75406772,
                        "mana": 3.91155776,
                        "matic": 2.94296056,
                        "mbx": 2.98872954,
                        "mdl": 19.26767878,
                        "mga": 5026.26795542,
                        "mgf": 25131.33977708,
                        "mina": 2.22927989,
                        "mkd": 61.53316374,
                        "mkr": 0.00080580727,
                        "mmk": 2296.62085019,
                        "mnt": 3719.9943568,
                        "mop": 8.76073526,
                        "mro": 433.79935366,
                        "mru": 43.37993537,
                        "mtl": 0.4293,
                        "mur": 50.35660098,
                        "mvr": 16.84889564,
                        "mwk": 1899.96574815,
                        "mxn": 21.30313573,
                        "mxv": 2.57320593,
                        "myr": 4.69813339,
                        "mzm": 69932.94688814,
                        "mzn": 69.93294689,
                        "nad": 19.31241731,
                        "near": 0.23767052,
                        "neo": 0.10892399,
                        "nexo": 1.13133068,
                        "nft": 2664780.30386394,
                        "ngn": 1773.24822955,
                        "nio": 40.32192474,
                        "nlg": 2.20371,
                        "nok": 11.78854207,
                        "npr": 147.08306851,
                        "nzd": 1.8010576,
                        "okb": 0.026724364,
                        "omr": 0.42135664,
                        "one": 89.19624778,
                        "op": 0.70690077,
                        "ordi": 0.033207942,
                        "pab": 1.09440282,
                        "paxg": 0.00041777754,
                        "pen": 4.08669963,
                        "pepe": 118853.19837793,
                        "pgk": 4.3467445,
                        "php": 62.56919048,
                        "pkr": 304.38618532,
                        "pln": 4.29921849,
                        "pte": 200.48200001,
                        "pyg": 8544.22966089,
                        "qar": 3.98362627,
                        "qnt": 0.016528036,
                        "qtum": 0.46698346,
                        "rol": 49756.35145037,
                        "ron": 4.97563515,
                        "rpl": 0.10898058,
                        "rsd": 117.05772187,
                        "rub": 106.24068639,
                        "rune": 0.23663725,
                        "rvn": 67.43747252,
                        "rwf": 1476.0668569,
                        "sand": 4.4356467,
                        "sar": 4.10401058,
                        "sbd": 9.18734653,
                        "scr": 15.26744226,
                        "sdd": 65778.577228,
                        "sdg": 657.78577228,
                        "sek": 11.37760109,
                        "sgd": 1.43009053,
                        "shib": 63995.82935545,
                        "shp": 0.83710232,
                        "sit": 239.64000001,
                        "skk": 30.126,
                        "sle": 24.71347884,
                        "sll": 24713.47883552,
                        "snx": 0.79581263,
                        "sol": 0.0078566394,
                        "sos": 625.19707645,
                        "spl": 0.18240047,
                        "srd": 35.14828932,
                        "srg": 35148.28931726,
                        "std": 24513.05374013,
                        "stn": 24.51305374,
                        "stx": 0.65626513,
                        "sui": 0.57840872,
                        "svc": 9.57602469,
                        "syp": 14229.00072054,
                        "szl": 19.31241731,
                        "thb": 36.70273475,
                        "theta": 0.89259534,
                        "tjs": 11.67171269,
                        "tmm": 19195.45467896,
                        "tmt": 3.83909094,
                        "tnd": 3.36123425,
                        "ton": 0.21544454,
                        "top": 2.57218797,
                        "trl": 37509273.61916009,
                        "trx": 6.86207407,
                        "try": 37.50927362,
                        "ttd": 7.42898586,
                        "tusd": 1.09855886,
                        "tvd": 1.62802767,
                        "twd": 35.28348066,
                        "twt": 1.05904571,
                        "tzs": 2981.32464434,
                        "uah": 45.11941611,
                        "ugx": 4023.92418324,
                        "uni": 0.14788356,
                        "usd": 1.09440282,
                        "usdc": 1.09466575,
                        "usdd": 1.09818286,
                        "usdp": 1.09450236,
                        "usdt": 1.09521854,
                        "uyu": 45.2339489,
                        "uzs": 14017.57183449,
                        "val": 1936.27000006,
                        "veb": 4096036050.284648,
                        "ved": 41.00762944,
                        "vef": 4100762.94444189,
                        "ves": 41.00762944,
                        "vet": 49.70137066,
                        "vnd": 27201.41916532,
                        "vuv": 130.27757186,
                        "waves": 1.01269891,
                        "wemix": 1.37758573,
                        "woo": 6.73991853,
                        "wst": 2.97871846,
                        "xaf": 655.95700002,
                        "xag": 0.035962976,
                        "xau": 0.00041959689,
                        "xaut": 0.00041933319,
                        "xbt": 0.00001802372,
                        "xcd": 2.95600719,
                        "xch": 0.070446902,
                        "xdc": 38.35991087,
                        "xdr": 0.81788631,
                        "xec": 33291.94825801,
                        "xem": 63.39394802,
                        "xlm": 12.18496913,
                        "xmr": 0.0072872271,
                        "xof": 655.95700002,
                        "xpd": 0.0010451466,
                        "xpf": 119.33174225,
                        "xpt": 0.0011430437,
                        "xrp": 2.08105579,
                        "xtz": 1.67641387,
                        "yer": 273.95351493,
                        "zar": 19.31241731,
                        "zec": 0.037260414,
                        "zil": 78.01602856,
                        "zmk": 28979.64941208,
                        "zmw": 28.97964941,
                        "zwd": 396.06438137,
                        "zwg": 15.42205086,
                        "zwl": 38535.45170337
                  }
                }
                """

}
